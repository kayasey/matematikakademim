webpackJsonp([114],{1843:function(n,l,e){"use strict";function t(n){return c._42(0,[(n()(),c._16(0,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.openCourseFilter(e)&&t}return t},H.b,H.a)),c._15(1,1097728,[[3,4]],0,U.a,[[8,""],W.a,c.p,c.K],null,null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n                "])),(n()(),c._16(4,0,null,0,1,"ion-icon",[["name","funnel"],["role","img"]],[[2,"hide",null]],null,null,null,null)),c._15(5,147456,null,0,Y.a,[W.a,c.p,c.K],{name:[0,"name"]},null),(n()(),c._40(-1,0,["\n            "]))],function(n,l){n(l,5,0,"funnel")},function(n,l){n(l,0,0,c._41(l,0,0,c._29(l,2).transform("core.courses.filter")));n(l,4,0,c._29(l,5)._hidden)})}function i(n){return c._42(0,[(n()(),c._16(0,0,null,null,3,"core-empty-box",[["icon","calendar"]],null,null,null,z.b,z.a)),c._15(1,49152,null,0,B.a,[],{message:[0,"message"],icon:[1,"icon"]},null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n            "]))],function(n,l){n(l,1,0,c._41(l,1,0,c._29(l,2).transform("addon.calendar.noevents")),"calendar")},null)}function a(n){return c._42(0,[(n()(),c._16(0,0,null,null,0,"img",[["class","core-module-icon"],["item-start",""]],[[8,"src",4]],null,null,null,null))],null,function(n,l){n(l,0,0,c._19(1,"",l.parent.context.$implicit.moduleIcon,""))})}function u(n){return c._42(0,[(n()(),c._16(0,0,null,null,1,"core-icon",[["item-start",""]],null,null,null,G.b,G.a)),c._15(1,114688,null,0,J.a,[c.p],{name:[0,"name"]},null)],function(n,l){n(l,1,0,l.parent.context.$implicit.icon)},null)}function o(n){return c._42(0,[(n()(),c._16(0,0,null,null,20,"a",[["class","item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.gotoEvent(n.context.$implicit.id)&&t}return t},q.b,q.a)),c._15(1,1097728,null,3,Q.a,[X.a,W.a,c.p,c.K,[2,Z.a]],null,null),c._37(335544320,4,{contentLabel:0}),c._37(603979776,5,{_buttons:1}),c._37(603979776,6,{_icons:1}),c._15(5,16384,null,0,nn.a,[],null,null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._11(16777216,null,0,1,null,a)),c._15(8,16384,null,0,ln.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._11(16777216,null,0,1,null,u)),c._15(11,16384,null,0,ln.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._16(13,0,null,2,2,"h2",[],null,null,null,null,null)),(n()(),c._16(14,0,null,null,1,"core-format-text",[],null,null,null,null,null)),c._15(15,540672,null,0,en.a,[c.p,y.a,m.a,tn.a,V.a,an.a,b.a,un.a,on.a,rn.a,L.a,sn.a,[2,cn.a],[2,dn.a],[2,T.a],_n.a,I.a],{text:[0,"text"]},null),(n()(),c._40(-1,2,["\n                    "])),(n()(),c._16(17,0,null,2,2,"p",[],null,null,null,null,null)),(n()(),c._40(18,null,["",""])),c._34(19,1),(n()(),c._40(-1,2,["\n                "]))],function(n,l){n(l,8,0,l.context.$implicit.moduleIcon);n(l,11,0,l.context.$implicit.icon&&!l.context.$implicit.moduleIcon);n(l,15,0,l.context.$implicit.name)},function(n,l){n(l,0,0,l.context.$implicit.name,l.context.$implicit.id==l.component.eventId);n(l,18,0,c._41(l,18,0,n(l,19,0,c._29(l.parent.parent,0),l.context.$implicit.timestart)))})}function r(n){return c._42(0,[(n()(),c._16(0,0,null,null,5,"ion-list",[["no-margin",""]],null,null,null,null,null)),c._15(1,16384,null,0,fn.a,[W.a,c.p,c.K,an.a,hn.l,pn.a],null,null),(n()(),c._40(-1,null,["\n                "])),(n()(),c._11(16777216,null,null,1,null,o)),c._15(4,802816,null,0,ln.j,[c.W,c.T,c.v],{ngForOf:[0,"ngForOf"]},null),(n()(),c._40(-1,null,["\n            "]))],function(n,l){n(l,4,0,l.component.filteredEvents)},null)}function s(n){return c._42(0,[c._32(0,vn.a,[on.a]),c._37(402653184,1,{content:0}),c._37(402653184,2,{splitviewCtrl:0}),(n()(),c._16(3,0,null,null,28,"ion-header",[],null,null,null,null,null)),c._15(4,16384,null,0,gn.a,[W.a,c.p,c.K,[2,mn.a]],null,null),(n()(),c._40(-1,null,["\n    "])),(n()(),c._16(6,0,null,null,24,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,bn.b,bn.a)),c._15(7,49152,null,0,yn.a,[En.a,[2,mn.a],[2,cn.a],W.a,c.p,c.K],null,null),c._15(8,212992,null,0,Cn.a,[yn.a,an.a,V.a,I.a],null,null),(n()(),c._40(-1,3,["\n        "])),(n()(),c._16(10,0,null,3,3,"ion-title",[],null,null,null,In.b,In.a)),c._15(11,49152,null,0,Ln.a,[W.a,c.p,c.K,[2,Tn.a],[2,yn.a]],null,null),(n()(),c._40(12,0,["",""])),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,3,["\n        "])),(n()(),c._16(15,0,null,2,14,"ion-buttons",[["end",""]],null,null,null,null,null)),c._15(16,16384,null,1,xn.a,[W.a,c.p,c.K,[2,Tn.a],[2,yn.a]],null,null),c._37(603979776,3,{_buttons:1}),(n()(),c._40(-1,null,["\n            "])),(n()(),c._11(16777216,null,null,1,null,t)),c._15(20,16384,null,0,ln.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,null,["\n            "])),(n()(),c._16(22,0,null,null,6,"core-context-menu",[],null,null,null,Dn.b,Dn.a)),c._15(23,245760,null,0,Pn.a,[V.a,An.a,c.p,m.a,[2,kn.a]],null,null),(n()(),c._40(-1,0,["\n                "])),(n()(),c._16(25,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,l,e){var t=!0;if("action"===l){t=!1!==n.component.openSettings()&&t}return t},Rn.b,Rn.a)),c._15(26,770048,null,0,Fn.a,[Pn.a],{content:[0,"content"],iconAction:[1,"iconAction"],priority:[2,"priority"],hidden:[3,"hidden"]},{action:"action"}),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,0,["\n            "])),(n()(),c._40(-1,null,["\n        "])),(n()(),c._40(-1,3,["\n    "])),(n()(),c._40(-1,null,["\n"])),(n()(),c._40(-1,null,["\n"])),(n()(),c._16(33,0,null,null,31,"core-split-view",[],null,null,null,$n.b,$n.a)),c._15(34,245760,[[2,4]],0,T.a,[[2,cn.a],c.p,wn.a,an.a,V.a],null,null),(n()(),c._40(-1,0,["\n    "])),(n()(),c._16(36,0,null,0,27,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Kn.b,Kn.a)),c._15(37,4374528,[[1,4]],0,dn.a,[W.a,an.a,pn.a,c.p,c.K,En.a,Mn.a,c.D,[2,mn.a],[2,cn.a]],null,null),(n()(),c._40(-1,1,["\n        "])),(n()(),c._16(39,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(n,l,e){var t=!0;if("ionRefresh"===l){t=!1!==n.component.refreshEvents(e)&&t}return t},null,null)),c._15(40,212992,null,0,Nn.a,[an.a,dn.a,c.D,hn.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(n()(),c._40(-1,null,["\n            "])),(n()(),c._16(42,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,On.b,On.a)),c._15(43,114688,null,0,Sn.a,[Nn.a,W.a],{pullingText:[0,"pullingText"]},null),c._32(131072,j.a,[V.a,c.i]),(n()(),c._40(-1,null,["\n        "])),(n()(),c._40(-1,1,["\n        "])),(n()(),c._16(47,0,null,1,15,"core-loading",[],null,null,null,Hn.b,Hn.a)),c._15(48,638976,null,0,Un.a,[V.a,c.p,I.a,b.a],{hideUntil:[0,"hideUntil"]},null),(n()(),c._40(-1,0,["\n            "])),(n()(),c._11(16777216,null,0,1,null,i)),c._15(51,16384,null,0,ln.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,0,["\n\n            "])),(n()(),c._11(16777216,null,0,1,null,r)),c._15(54,16384,null,0,ln.k,[c.W,c.T],{ngIf:[0,"ngIf"]},null),(n()(),c._40(-1,0,["\n\n            "])),(n()(),c._16(56,0,null,0,5,"ion-infinite-scroll",[],null,[[null,"ionInfinite"]],function(n,l,e){var t=!0;if("ionInfinite"===l){t=!1!==e.waitFor(n.component.fetchEvents())&&t}return t},null,null)),c._15(57,1196032,null,0,Wn.a,[dn.a,c.D,c.p,pn.a],{enabled:[0,"enabled"]},{ionInfinite:"ionInfinite"}),(n()(),c._40(-1,null,["\n               "])),(n()(),c._16(59,0,null,null,1,"ion-infinite-scroll-content",[],[[1,"state",0]],null,null,jn.b,jn.a)),c._15(60,114688,null,0,Vn.a,[Wn.a,W.a],null,null),(n()(),c._40(-1,null,["\n            "])),(n()(),c._40(-1,0,["\n        "])),(n()(),c._40(-1,1,["\n    "])),(n()(),c._40(-1,0,["\n"]))],function(n,l){var e=l.component;n(l,8,0);n(l,20,0,e.courses&&e.courses.length),n(l,23,0);n(l,26,0,c._41(l,26,0,c._29(l,27).transform("core.settings.settings")),"cog",600,!e.notificationsEnabled),n(l,34,0);n(l,40,0,e.eventsLoaded);n(l,43,0,c._19(1,"",c._41(l,43,0,c._29(l,44).transform("core.pulltorefresh")),""));n(l,48,0,e.eventsLoaded);n(l,51,0,!e.filteredEvents||!e.filteredEvents.length);n(l,54,0,e.filteredEvents&&e.filteredEvents.length);n(l,57,0,e.canLoadMore),n(l,60,0)},function(n,l){n(l,6,0,c._29(l,7)._hidden,c._29(l,7)._sbPadding);n(l,12,0,c._41(l,12,0,c._29(l,13).transform("addon.calendar.calendarevents")));n(l,36,0,c._29(l,37).statusbarPadding,c._29(l,37)._hasRefresher);n(l,39,0,"inactive"!==c._29(l,40).state,c._29(l,40)._top);n(l,42,0,c._29(l,43).r.state);n(l,59,0,c._29(l,60).inf.state)})}Object.defineProperty(l,"__esModule",{value:!0});var c=e(1),d=(e(0),e(10),e(5)),_=e(33),f=e(29),h=e(110),p=e(329),v=e(643),g=e(73),m=e(4),b=e(3),y=e(2),E=e(131),C=e(677),I=e(13),L=e(11),T=e(35),x=function(){function n(n,l,e,t,i,a,u,o,r,s,c,d,_){var f=this;this.translate=n,this.calendarProvider=l,this.domUtils=t,this.coursesProvider=i,this.utils=a,this.calendarHelper=u,this.popoverCtrl=s,this.navCtrl=d,this.daysLoaded=0,this.emptyEventsTimes=0,this.categoriesRetrieved=!1,this.getCategories=!1,this.allCourses={id:-1,fullname:this.translate.instant("core.fulllistofcourses"),category:-1},this.categories={},this.eventsLoaded=!1,this.events=[],this.notificationsEnabled=!1,this.filteredEvents=[],this.canLoadMore=!1,this.filter={course:this.allCourses},this.siteHomeId=o.getCurrentSite().getSiteHomeId(),this.notificationsEnabled=r.isAvailable(),this.notificationsEnabled&&(this.obsDefaultTimeChange=c.on(p.a.DEFAULT_NOTIFICATION_TIME_CHANGED,function(){l.scheduleEventsNotifications(f.events)},o.getCurrentSiteId())),this.eventId=e.get("eventId")||!1}return n.prototype.ionViewDidLoad=function(){var n=this;this.eventId&&this.gotoEvent(this.eventId),this.fetchData().then(function(){!n.eventId&&n.splitviewCtrl.isOn()&&n.events.length>0&&n.gotoEvent(n.events[0].id)}).finally(function(){n.eventsLoaded=!0})},n.prototype.fetchData=function(n){var l=this;return void 0===n&&(n=!1),this.daysLoaded=0,this.emptyEventsTimes=0,this.coursesProvider.getUserCourses(!1).then(function(e){return e.unshift(l.allCourses),l.courses=e,l.fetchEvents(n)})},n.prototype.fetchEvents=function(n){var l=this;return void 0===n&&(n=!1),this.calendarProvider.getEventsList(this.daysLoaded,p.a.DAYS_INTERVAL).then(function(e){if(l.daysLoaded+=p.a.DAYS_INTERVAL,0===e.length){if(l.emptyEventsTimes++,!(l.emptyEventsTimes>5))return l.fetchEvents();l.canLoadMore=!1,n&&(l.events=[],l.filteredEvents=[])}else e.sort(function(n,l){return n.timestart-l.timestart}),e.forEach(l.calendarHelper.formatEventData.bind(l.calendarHelper)),l.getCategories=l.shouldLoadCategories(e),l.events=n?e:l.utils.mergeArraysWithoutDuplicates(l.events,e,"id"),l.filteredEvents=l.getFilteredEvents(),l.canLoadMore=!0,l.calendarProvider.scheduleEventsNotifications(l.events);l.content.resize()}).catch(function(n){l.domUtils.showErrorModalDefault(n,"addon.calendar.errorloadevents",!0),l.canLoadMore=!1}).then(function(){if(l.getCategories)return l.getCategories=!1,l.loadCategories()})},n.prototype.getFilteredEvents=function(){return-1==this.filter.course.id?this.events:this.events.filter(this.shouldDisplayEvent.bind(this))},n.prototype.shouldDisplayEvent=function(n){if("user"==n.eventtype||"site"==n.eventtype)return!0;if("category"==n.eventtype){if(!n.categoryid||!Object.keys(this.categories).length)return!0;if(n.categoryid==this.filter.course.category)return!0;for(var l=this.categories[this.filter.course.category];l&&l.parent;){if(n.categoryid==l.parent)return!0;l=this.categories[l.parent]}return!1}return n.courseid===this.siteHomeId||n.courseid==this.filter.course.id},n.prototype.shouldLoadCategories=function(n){if(this.categoriesRetrieved||this.getCategories)return this.getCategories;return n.some(function(n){return"undefined"!=n.categoryid&&n.categoryid>0})||this.getCategories},n.prototype.loadCategories=function(){var n=this;return this.coursesProvider.getCategories(0,!0).then(function(l){n.categoriesRetrieved=!0,n.categories={},l.forEach(function(l){n.categories[l.id]=l})}).catch(function(){})},n.prototype.refreshEvents=function(n){var l=this,e=[];e.push(this.calendarProvider.invalidateEventsList(this.courses)),this.categoriesRetrieved&&(e.push(this.coursesProvider.invalidateCategories(0,!0)),this.categoriesRetrieved=!1),Promise.all(e).finally(function(){l.fetchData(!0).finally(function(){n.complete()})})},n.prototype.openCourseFilter=function(n){var l=this,e=this.popoverCtrl.create(C.a,{courses:this.courses,courseId:this.filter.course.id});e.onDidDismiss(function(n){n&&(l.filter.course=n,l.domUtils.scrollToTop(l.content),l.filteredEvents=l.getFilteredEvents())}),e.present({ev:n})},n.prototype.openSettings=function(){this.navCtrl.push("AddonCalendarSettingsPage")},n.prototype.gotoEvent=function(n){this.eventId=n,this.splitviewCtrl.push("AddonCalendarEventPage",{id:n})},n.prototype.ngOnDestroy=function(){this.obsDefaultTimeChange&&this.obsDefaultTimeChange.off()},n}(),D=function(){return function(){}}(),P=e(1273),A=e(1274),k=e(1275),R=e(1276),F=e(1277),$=e(1278),w=e(1279),K=e(1280),M=e(1281),N=e(1284),O=e(1285),S=e(1286),H=e(46),U=e(41),W=e(7),j=e(30),V=e(18),Y=e(42),z=e(164),B=e(134),G=e(194),J=e(165),q=e(34),Q=e(21),X=e(20),Z=e(28),nn=e(31),ln=e(9),en=e(40),tn=e(12),an=e(15),un=e(25),on=e(6),rn=e(17),sn=e(23),cn=e(22),dn=e(24),_n=e(38),fn=e(75),hn=e(37),pn=e(26),vn=e(637),gn=e(417),mn=e(36),bn=e(1282),yn=e(191),En=e(27),Cn=e(632),In=e(1283),Ln=e(324),Tn=e(236),xn=e(418),Dn=e(87),Pn=e(71),An=e(69),kn=e(70),Rn=e(86),Fn=e(78),$n=e(421),wn=e(63),Kn=e(178),Mn=e(100),Nn=e(133),On=e(192),Sn=e(145),Hn=e(57),Un=e(51),Wn=e(219),jn=e(429),Vn=e(243),Yn=e(60),zn=c._14({encapsulation:2,styles:[],data:{}}),Bn=c._12("page-addon-calendar-list",x,function(n){return c._42(0,[(n()(),c._16(0,0,null,null,1,"page-addon-calendar-list",[],null,null,null,s,zn)),c._15(1,180224,null,0,x,[V.a,p.a,Yn.a,m.a,g.a,b.a,v.a,y.a,E.a,An.a,I.a,cn.a,L.a],null,null)],null,null)},{},{},[]),Gn=e(19),Jn=e(320),qn=e(321),Qn=e(323),Xn=e(322),Zn=e(416),nl=e(631),ll=e(237);e.d(l,"AddonCalendarListPageModuleNgFactory",function(){return el});var el=c._13(D,[],function(n){return c._25([c._26(512,c.n,c._6,[[8,[P.a,A.a,k.a,R.a,F.a,$.a,w.a,K.a,M.a,N.a,O.a,S.a,Bn]],[3,c.n],c.B]),c._26(4608,ln.m,ln.l,[c.x,[2,ln.v]]),c._26(4608,Gn.x,Gn.x,[]),c._26(4608,Gn.d,Gn.d,[]),c._26(4608,Jn.b,Jn.a,[]),c._26(4608,qn.a,qn.b,[]),c._26(4608,Qn.b,Qn.a,[]),c._26(4608,Xn.b,Xn.a,[]),c._26(4608,V.a,V.a,[Zn.a,Jn.b,qn.a,Qn.b,Xn.b,V.b,V.c]),c._26(512,ln.b,ln.b,[]),c._26(512,Gn.v,Gn.v,[]),c._26(512,Gn.i,Gn.i,[]),c._26(512,Gn.s,Gn.s,[]),c._26(512,nl.a,nl.a,[]),c._26(512,d.a,d.a,[]),c._26(512,f.a,f.a,[]),c._26(512,h.a,h.a,[]),c._26(512,_.a,_.a,[]),c._26(512,nl.b,nl.b,[]),c._26(512,D,D,[]),c._26(256,V.c,void 0,[]),c._26(256,V.b,void 0,[]),c._26(256,ll.a,x,[])])})}});