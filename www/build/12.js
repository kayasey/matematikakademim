webpackJsonp([12],{1871:function(n,l,e){"use strict";function t(n){return d._42(0,[(n()(),d._16(0,0,null,null,7,"ion-chip",[["class","addon-messages-date"],["color","light"]],null,null,null,null,null)),d._15(1,16384,null,0,z.a,[$.a,d.p,d.K],{color:[0,"color"]},null),(n()(),d._40(-1,null,["\n                    "])),(n()(),d._16(3,0,null,null,3,"ion-label",[],null,null,null,null,null)),d._15(4,16384,null,0,N.a,[$.a,d.p,d.K,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),d._40(5,null,["",""])),d._34(6,2),(n()(),d._40(-1,null,["\n                "]))],function(n,l){n(l,1,0,"light")},function(n,l){n(l,5,0,d._41(l,5,0,n(l,6,0,d._29(l.parent.parent,0),l.parent.context.$implicit.timecreated,"LL")))})}function s(n){return d._42(0,[(n()(),d._16(0,0,null,null,11,"ion-chip",[["class","addon-messages-unreadfrom"],["color","light"]],null,null,null,null,null)),d._15(1,16384,null,0,z.a,[$.a,d.p,d.K],{color:[0,"color"]},null),(n()(),d._40(-1,null,["\n                    "])),(n()(),d._16(3,0,null,null,4,"ion-label",[],null,null,null,null,null)),d._15(4,16384,null,0,N.a,[$.a,d.p,d.K,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),d._40(5,null,["",""])),d._33(6,{$a:0}),d._32(131072,H.a,[W.a,d.i]),(n()(),d._40(-1,null,["\n                    "])),(n()(),d._16(9,0,null,null,1,"ion-icon",[["name","arrow-round-down"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._15(10,147456,null,0,V.a,[$.a,d.p,d.K],{name:[0,"name"]},null),(n()(),d._40(-1,null,["\n                "]))],function(n,l){n(l,1,0,"light");n(l,10,0,"arrow-round-down")},function(n,l){var e=l.component;n(l,5,0,d._41(l,5,0,d._29(l,7).transform("addon.messages.newmessages",n(l,6,0,e.title))));n(l,9,0,d._29(l,10)._hidden)})}function a(n){return d._42(0,[(n()(),d._16(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),d._15(1,16384,null,0,j.a,[$.a,d.p,d.K],null,null),(n()(),d._40(2,null,["\n                        ","\n                    "])),d._34(3,2)],null,function(n,l){n(l,2,0,d._41(l,2,0,n(l,3,0,d._29(l.parent.parent,0),l.parent.context.$implicit.timecreated,"dftimedate")))})}function o(n){return d._42(0,[(n()(),d._16(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),d._15(1,16384,null,0,j.a,[$.a,d.p,d.K],null,null),(n()(),d._16(2,0,null,null,1,"ion-icon",[["name","time"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._15(3,147456,null,0,V.a,[$.a,d.p,d.K],{name:[0,"name"]},null)],function(n,l){n(l,3,0,"time")},function(n,l){n(l,2,0,d._29(l,3)._hidden)})}function i(n){return d._42(0,[(n()(),d._16(0,0,null,null,6,"button",[["class","addon-messages-delete-button"],["clear","true"],["icon-only",""],["ion-button",""]],[[24,"@coreSlideInOut",0],[1,"aria-label",0]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.deleteMessage(n.parent.context.$implicit,n.parent.context.index)&&t}return t},G.b,G.a)),d._15(1,1097728,[[5,4]],0,q.a,[[8,""],$.a,d.p,d.K],{clear:[0,"clear"]},null),d._32(131072,H.a,[W.a,d.i]),(n()(),d._40(-1,0,["\n                        "])),(n()(),d._16(4,0,null,0,1,"ion-icon",[["color","danger"],["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._15(5,147456,null,0,V.a,[$.a,d.p,d.K],{color:[0,"color"],name:[1,"name"]},null),(n()(),d._40(-1,0,["\n                    "]))],function(n,l){n(l,1,0,"true");n(l,5,0,"danger","trash")},function(n,l){n(l,0,0,"fromRight",d._41(l,0,1,d._29(l,2).transform("addon.messages.deletemessage")));n(l,4,0,d._29(l,5)._hidden)})}function u(n){return d._42(0,[(n()(),d._16(0,0,null,null,32,null,null,null,null,null,null,null)),(n()(),d._40(-1,null,["\n                "])),(n()(),d._11(16777216,null,null,1,null,t)),d._15(3,16384,null,0,Y.k,[d.W,d.T],{ngIf:[0,"ngIf"]},null),(n()(),d._40(-1,null,["\n\n                "])),(n()(),d._11(16777216,null,null,1,null,s)),d._15(6,16384,null,0,Y.k,[d.W,d.T],{ngIf:[0,"ngIf"]},null),(n()(),d._40(-1,null,["\n\n                "])),(n()(),d._16(8,0,null,null,23,"ion-item",[["class","addon-message item item-block"],["text-wrap",""]],[[2,"addon-message-mine",null],[24,"@coreSlideInOut",0]],[[null,"longPress"]],function(n,l,e){var t=!0;if("longPress"===l){t=!1!==n.component.copyMessage(n.context.$implicit.smallmessage)&&t}return t},J.b,J.a)),d._15(9,212992,null,0,Q.a,[d.p],null,{longPress:"longPress"}),d._15(10,1097728,null,3,Z.a,[nn.a,$.a,d.p,d.K,[2,ln.a]],null,null),d._37(335544320,4,{contentLabel:0}),d._37(603979776,5,{_buttons:1}),d._37(603979776,6,{_icons:1}),d._15(14,16384,null,0,en.a,[],null,null),(n()(),d._40(-1,2,["\n                    "])),(n()(),d._40(-1,2,["\n                    "])),(n()(),d._16(17,0,null,2,4,"p",[["class","addon-message-text"]],null,null,null,null,null)),(n()(),d._40(-1,null,["\n                        "])),(n()(),d._16(19,0,null,null,1,"core-format-text",[],null,[[null,"afterRender"]],function(n,l,e){var t=!0;if("afterRender"===l){t=!1!==(n.context.last&&n.component.scrollToBottom())&&t}return t},null,null)),d._15(20,540672,null,0,tn.a,[d.p,m.a,y.a,sn.a,W.a,an.a,v.a,on.a,b.a,un.a,M.a,rn.a,[2,cn.a],[2,dn.a],[2,gn.a],fn.a,f.a],{text:[0,"text"]},{afterRender:"afterRender"}),(n()(),d._40(-1,null,["\n                    "])),(n()(),d._40(-1,2,["\n                    "])),(n()(),d._11(16777216,null,2,1,null,a)),d._15(24,16384,null,0,Y.k,[d.W,d.T],{ngIf:[0,"ngIf"]},null),(n()(),d._40(-1,2,["\n                    "])),(n()(),d._11(16777216,null,2,1,null,o)),d._15(27,16384,null,0,Y.k,[d.W,d.T],{ngIf:[0,"ngIf"]},null),(n()(),d._40(-1,2,["\n\n                    "])),(n()(),d._11(16777216,null,2,1,null,i)),d._15(30,16384,null,0,Y.k,[d.W,d.T],{ngIf:[0,"ngIf"]},null),(n()(),d._40(-1,2,["\n                "])),(n()(),d._40(-1,null,["\n            "]))],function(n,l){var e=l.component;n(l,3,0,e.showDate(l.context.$implicit,e.messages[l.context.index-1]));n(l,6,0,l.context.$implicit.unreadFrom),n(l,9,0);n(l,20,0,l.context.$implicit.text);n(l,24,0,!l.context.$implicit.pending);n(l,27,0,l.context.$implicit.pending);n(l,30,0,!l.context.$implicit.sending&&e.showDelete)},function(n,l){var e=l.component;n(l,8,0,l.context.$implicit.useridfrom==e.currentUserId,l.context.$implicit.useridfrom==e.currentUserId?"":"fromLeft")})}function r(n){return d._42(0,[(n()(),d._16(0,0,null,null,2,"core-empty-box",[["icon","chatbubbles"]],null,null,null,mn.b,mn.a)),d._15(1,49152,null,0,hn.a,[],{message:[0,"message"],icon:[1,"icon"]},null),d._32(131072,H.a,[W.a,d.i])],function(n,l){n(l,1,0,d._41(l,1,0,d._29(l,2).transform("addon.messages.nomessages")),"chatbubbles")},null)}function c(n){return d._42(0,[d._32(0,_n.a,[b.a,W.a]),d._37(402653184,1,{content:0}),(n()(),d._16(2,0,null,null,36,"ion-header",[],null,null,null,null,null)),d._15(3,16384,null,0,pn.a,[$.a,d.p,d.K,[2,yn.a]],null,null),(n()(),d._40(-1,null,["\n    "])),(n()(),d._16(5,0,null,null,12,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,vn.b,vn.a)),d._15(6,49152,null,0,bn.a,[Mn.a,[2,yn.a],[2,cn.a],$.a,d.p,d.K],null,null),d._15(7,212992,null,0,wn.a,[bn.a,an.a,W.a,f.a],null,null),(n()(),d._40(-1,3,["\n        "])),(n()(),d._16(9,0,null,3,3,"ion-title",[],null,null,null,In.b,In.a)),d._15(10,49152,null,0,Pn.a,[$.a,d.p,d.K,[2,Cn.a],[2,bn.a]],null,null),(n()(),d._16(11,0,null,0,1,"core-format-text",[],null,null,null,null,null)),d._15(12,540672,null,0,tn.a,[d.p,m.a,y.a,sn.a,W.a,an.a,v.a,on.a,b.a,un.a,M.a,rn.a,[2,cn.a],[2,dn.a],[2,gn.a],fn.a,f.a],{text:[0,"text"]},null),(n()(),d._40(-1,3,["\n        "])),(n()(),d._16(14,0,null,2,2,"ion-buttons",[["end",""]],null,null,null,null,null)),d._15(15,16384,null,1,Dn.a,[$.a,d.p,d.K,[2,Cn.a],[2,bn.a]],null,null),d._37(603979776,2,{_buttons:1}),(n()(),d._40(-1,3,["\n    "])),(n()(),d._40(-1,null,["\n    "])),(n()(),d._16(19,0,null,null,18,"core-navbar-buttons",[["end",""]],null,null,null,kn.b,kn.a)),d._15(20,245760,null,1,xn.a,[d.p,b.a,y.a],null,null),d._37(603979776,3,{buttons:1}),(n()(),d._40(-1,0,["\n        "])),(n()(),d._16(23,0,null,0,5,"button",[["clear","true"],["icon-only",""],["ion-button",""]],[[8,"hidden",0]],[[null,"click"]],function(n,l,e){var t=!0;if("click"===l){t=!1!==n.component.toggleDelete()&&t}return t},G.b,G.a)),d._15(24,1097728,[[3,4]],0,q.a,[[8,""],$.a,d.p,d.K],{clear:[0,"clear"]},null),(n()(),d._40(-1,0,["\n            "])),(n()(),d._16(26,0,null,0,1,"ion-icon",[["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),d._15(27,147456,null,0,V.a,[$.a,d.p,d.K],{name:[0,"name"]},null),(n()(),d._40(-1,0,["\n        "])),(n()(),d._40(-1,0,["\n        "])),(n()(),d._16(30,0,null,0,6,"a",[["core-user-link",""]],[[8,"hidden",0],[1,"aria-label",0]],null,null,null,null)),d._15(31,81920,null,0,Un.a,[d.p,[2,cn.a]],{userId:[0,"userId"]},null),d._32(131072,H.a,[W.a,d.i]),(n()(),d._40(-1,null,["\n            "])),(n()(),d._16(34,0,null,null,1,"img",[["class","button core-bar-button-image"],["core-external-content",""],["onError","this.src='assets/img/user-avatar.png'"]],[[8,"src",4]],null,null,null,null)),d._15(35,4210688,null,0,Kn.a,[d.p,b.a,un.a,an.a,m.a,y.a,on.a,M.a,v.a],null,null),(n()(),d._40(-1,null,["\n        "])),(n()(),d._40(-1,0,["\n    "])),(n()(),d._40(-1,null,["\n"])),(n()(),d._40(-1,null,["\n"])),(n()(),d._16(40,0,null,null,24,"ion-content",[["class","has-footer"]],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Ln.b,Ln.a)),d._15(41,4374528,[[1,4]],0,dn.a,[$.a,an.a,Sn.a,d.p,d.K,Mn.a,En.a,d.D,[2,yn.a],[2,cn.a]],null,null),(n()(),d._40(-1,1,["\n    "])),(n()(),d._16(43,0,null,1,20,"core-loading",[],null,null,null,Fn.b,Fn.a)),d._15(44,638976,null,0,Rn.a,[W.a,d.p,f.a,v.a],{hideUntil:[0,"hideUntil"]},null),(n()(),d._40(-1,0,["\n        "])),(n()(),d._40(-1,0,["\n        "])),(n()(),d._16(47,0,null,0,5,"ion-infinite-scroll",[["position","top"]],null,[[null,"ionInfinite"]],function(n,l,e){var t=!0;if("ionInfinite"===l){t=!1!==n.component.loadPrevious(e)&&t}return t},null,null)),d._15(48,1196032,null,0,Tn.a,[dn.a,d.D,d.p,Sn.a],{enabled:[0,"enabled"],position:[1,"position"]},{ionInfinite:"ionInfinite"}),(n()(),d._40(-1,null,["\n           "])),(n()(),d._16(50,0,null,null,1,"ion-infinite-scroll-content",[],[[1,"state",0]],null,null,An.b,An.a)),d._15(51,114688,null,0,Bn.a,[Tn.a,$.a],null,null),(n()(),d._40(-1,null,["\n        "])),(n()(),d._40(-1,0,["\n        "])),(n()(),d._16(54,0,null,0,5,"ion-list",[["class","addon-messages-discussion-container"]],[[1,"aria-live",0]],null,null,null,null)),d._15(55,16384,null,0,On.a,[$.a,d.p,d.K,an.a,Xn.l,Sn.a],null,null),(n()(),d._40(-1,null,["\n            "])),(n()(),d._11(16777216,null,null,1,null,u)),d._15(58,802816,null,0,Y.j,[d.W,d.T,d.v],{ngForOf:[0,"ngForOf"]},null),(n()(),d._40(-1,null,["\n        "])),(n()(),d._40(-1,0,["\n        "])),(n()(),d._11(16777216,null,0,1,null,r)),d._15(62,16384,null,0,Y.k,[d.W,d.T],{ngIf:[0,"ngIf"]},null),(n()(),d._40(-1,0,["\n    "])),(n()(),d._40(-1,1,["\n"])),(n()(),d._40(-1,null,["\n"])),(n()(),d._16(66,0,null,null,10,"ion-footer",[["class","footer-adjustable"],["color","light"]],null,null,null,null,null)),d._15(67,16384,null,0,zn.a,[$.a,d.p,d.K,[2,yn.a]],{color:[0,"color"]},null),(n()(),d._40(-1,null,["\n    "])),(n()(),d._16(69,0,null,null,6,"ion-toolbar",[["class","toolbar"],["color","light"],["position","bottom"]],[[2,"statusbar-padding",null]],null,null,$n.b,$n.a)),d._15(70,49152,null,0,Cn.a,[$.a,d.p,d.K],{color:[0,"color"]},null),(n()(),d._40(-1,3,["\n        "])),(n()(),d._16(72,0,null,3,2,"core-send-message-form",[],null,[[null,"onSubmit"],[null,"onResize"]],function(n,l,e){var t=!0,s=n.component;if("onSubmit"===l){t=!1!==s.sendMessage(e)&&t}if("onResize"===l){t=!1!==s.resizeContent()&&t}return t},Nn.b,Nn.a)),d._15(73,114688,null,0,Hn.a,[v.a,sn.a],{placeholder:[0,"placeholder"],showKeyboard:[1,"showKeyboard"]},{onSubmit:"onSubmit",onResize:"onResize"}),d._32(131072,H.a,[W.a,d.i]),(n()(),d._40(-1,3,["\n    "])),(n()(),d._40(-1,null,["\n"])),(n()(),d._40(-1,null,["\n"]))],function(n,l){var e=l.component;n(l,7,0);n(l,12,0,e.title),n(l,20,0);n(l,24,0,"true");n(l,27,0,"trash");n(l,31,0,e.userId);n(l,44,0,e.loaded);n(l,48,0,e.canLoadMore,"top"),n(l,51,0);n(l,58,0,e.messages);n(l,62,0,!e.messages||e.messages.length<=0);n(l,67,0,"light");n(l,70,0,"light");n(l,73,0,d._41(l,73,0,d._29(l,74).transform("addon.messages.newmessage")),e.showKeyboard)},function(n,l){var e=l.component;n(l,5,0,d._29(l,6)._hidden,d._29(l,6)._sbPadding);n(l,23,0,!e.canDelete);n(l,26,0,d._29(l,27)._hidden);n(l,30,0,!e.showProfileLink,d._41(l,30,1,d._29(l,32).transform("core.user.viewprofile")));n(l,34,0,e.profileLink);n(l,40,0,d._29(l,41).statusbarPadding,d._29(l,41)._hasRefresher);n(l,50,0,d._29(l,51).inf.state);n(l,54,0,e.polite);n(l,69,0,d._29(l,70)._sbPadding)})}Object.defineProperty(l,"__esModule",{value:!0});var d=e(1),g=(e(0),e(10),e(5)),f=e(13),m=e(2),h=e(168),_=e(443),p=e(45),y=e(4),v=e(3),b=e(6),M=e(11),w=(e(1356),e(189)),I=e(14),P=function(){function n(n,l,e,t,s,a,o,i,u,r,c,d){var g=this;this.eventsProvider=n,this.userProvider=t,this.navCtrl=s,this.messagesSync=a,this.domUtils=o,this.messagesProvider=i,this.utils=r,this.appProvider=c,this.translate=d,this.unreadMessageFrom=0,this.messagesBeingSent=0,this.pagesLoaded=1,this.lastMessage={text:"",timecreated:0},this.keepMessageMap={},this.oldContentHeight=0,this.loaded=!1,this.showKeyboard=!1,this.canLoadMore=!1,this.messages=[],this.showDelete=!1,this.canDelete=!1,this.scrollBottom=!0,this.viewDestroyed=!1,this.siteId=l.getCurrentSiteId(),this.currentUserId=l.getCurrentSiteUserId(),this.logger=u.getInstance("AddonMessagesDiscussionPage"),this.userId=e.get("userId"),this.showKeyboard=e.get("showKeyboard"),this.syncObserver=n.on(_.a.AUTO_SYNCED,function(n){n.userId==g.userId&&(g.fetchData(),n.warnings&&n.warnings[0]&&g.domUtils.showErrorModal(n.warnings[0]))},this.siteId)}return n.prototype.addMessage=function(n,l){void 0===l&&(l=!0),n.hash=w.Md5.hashAsciiStr(n.smallmessage)+"#"+n.timecreated+"#"+n.useridfrom,void 0===this.keepMessageMap[n.hash]&&this.messages.push(n),this.keepMessageMap[n.hash]=l},n.prototype.removeMessage=function(n){if(this.keepMessageMap[n])this.keepMessageMap[n]=!1;else{delete this.keepMessageMap[n];var l=this.messages.findIndex(function(l){return l.hash==n});l>0&&this.messages.splice(l,1)}},n.prototype.ionViewDidLoad=function(){var n=this,l=this.navCtrl.getPrevious()&&this.navCtrl.getPrevious().component.name;this.showProfileLink=!l||"CoreUserProfilePage"!==l,this.userProvider.getProfile(this.userId,void 0,!0).then(function(l){n.title||(n.title=l.fullname),n.profileLink=l.profileimageurl}),this.messagesSync.syncDiscussion(this.userId).catch(function(){}).then(function(l){return l&&l[0]&&n.domUtils.showErrorModal(l[0]),n.fetchData().then(function(){!n.title&&n.messages.length&&(n.title=n.messages[0].useridto!=n.currentUserId?n.messages[0].usertofullname||"":n.messages[0].userfromfullname||"")}).catch(function(l){n.domUtils.showErrorModalDefault(l,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){n.checkCanDelete(),n.resizeContent(),n.loaded=!0})}),this.keyboardObserver=this.eventsProvider.on(f.a.KEYBOARD_CHANGE,function(l){n.content.resize()})},n.prototype.ionViewDidEnter=function(){this.setPolling()},n.prototype.ionViewWillLeave=function(){this.unsetPolling()},n.prototype.fetchData=function(){var n=this;return this.logger.debug("Polling new messages for discussion with user '"+this.userId+"'"),this.messagesBeingSent>0?Promise.reject(null):this.fetching?Promise.reject(null):(this.fetching=!0,this.messagesSync.waitForSync(this.userId).then(function(){return n.messagesProvider.invalidateDiscussionCache(n.userId).catch(function(){})}).then(function(){return n.getDiscussion(n.pagesLoaded)}).then(function(l){if(n.viewDestroyed)return Promise.resolve();if(n.scrollBottom=n.domUtils.getScrollHeight(n.content)-n.domUtils.getScrollTop(n.content)===n.domUtils.getContentHeight(n.content),n.messagesBeingSent>0)return Promise.reject(null);l.forEach(function(l){n.addMessage(l)});for(var e in n.keepMessageMap)n.removeMessage(e);n.messagesProvider.sortMessages(n.messages),n.notifyNewMessage(),n.markMessagesAsRead()}).finally(function(){n.fetching=!1}))},n.prototype.getDiscussion=function(n,l,e,t,s){var a=this;void 0===l&&(l=0),void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s=0);return this.messagesProvider.getDiscussion(this.userId,l>0||e>0||t>0||s>0,l,e,t,s).then(function(o){return--n>0&&o.canLoadMore?(o.messages.forEach(function(n){n.pending||(n.useridfrom==a.userId?n.read?e++:l++:n.read?s++:t++)}),a.getDiscussion(n,l,e,t,s).then(function(n){return o.messages.concat(n)})):(a.canLoadMore=o.canLoadMore,o.messages)})},n.prototype.markMessagesAsRead=function(){var n=this,l=!1,e=[];if(this.messagesProvider.isMarkAllMessagesReadEnabled()){var t=!1;for(var s in this.messages){var a=this.messages[s];if(a.useridfrom!=this.currentUserId&&0==a.read){t=!0;break}}t&&(this.setUnreadLabelPosition(),e.push(this.messagesProvider.markAllMessagesRead(this.userId).then(function(){l=!0,n.messages.forEach(function(n){n.read=1})})))}else this.setUnreadLabelPosition(),this.messages.forEach(function(t){t.useridfrom!=n.currentUserId&&0==t.read&&e.push(n.messagesProvider.markMessageRead(t.id).then(function(){l=!0,t.read=1}))});Promise.all(e).finally(function(){l&&n.eventsProvider.trigger(h.a.READ_CHANGED_EVENT,{userId:n.userId},n.siteId)})},n.prototype.notifyNewMessage=function(){var n=this.messages[this.messages.length-1],l=!1;if(n?n.text===this.lastMessage.text&&n.timecreated===this.lastMessage.timecreated||(this.lastMessage={text:n.text,timecreated:n.timecreated},l=!0):(this.lastMessage={text:"",timecreated:0},l=!0),l){this.eventsProvider.trigger(h.a.NEW_MESSAGE_EVENT,{userId:this.userId,message:this.lastMessage.text,timecreated:this.lastMessage.timecreated},this.siteId);this.canDelete!=(n&&n.id&&1==this.messages.length||this.messages.length>1)&&this.checkCanDelete()}},n.prototype.setUnreadLabelPosition=function(){if(0==this.unreadMessageFrom){var n=!1;for(var l in this.messages){var e=this.messages[l];if(e.useridfrom!=this.currentUserId){if(e.unreadFrom=0==e.read&&n,e.unreadFrom){this.unreadMessageFrom=parseInt(e.id,10);break}n=0!=e.read}}0==this.unreadMessageFrom&&(this.unreadMessageFrom=-1)}},n.prototype.checkCanDelete=function(){var n=this.messages[0];this.canDelete=n&&!n.sending},n.prototype.hideUnreadLabel=function(){if(this.unreadMessageFrom>0){for(var n in this.messages){var l=this.messages[n];if(l.id==this.unreadMessageFrom){l.unreadFrom=!1;break}}this.unreadMessageFrom=-1}},n.prototype.waitForFetch=function(){var n=this;if(!this.fetching)return Promise.resolve();var l=this.utils.promiseDefer();return setTimeout(function(){return n.waitForFetch().finally(function(){l.resolve()})},400),l.promise},n.prototype.setPolling=function(){var n=this;this.polling||(this.polling=setInterval(function(){n.fetchData().catch(function(){})},h.a.POLL_INTERVAL))},n.prototype.unsetPolling=function(){this.polling&&(this.logger.debug("Cancelling polling for conversation with user '"+this.userId+"'"),clearInterval(this.polling),this.polling=void 0)},n.prototype.copyMessage=function(n){this.utils.copyToClipboard(n)},n.prototype.deleteMessage=function(n,l){var e=this;this.domUtils.showConfirm(this.translate.instant(n.pending?"core.areyousure":"addon.messages.deletemessageconfirmation")).then(function(){var t=e.domUtils.showModalLoading("core.deleting",!0);return e.messagesProvider.deleteMessage(n).then(function(){e.messages.splice(l,1),e.removeMessage(n.hash),e.notifyNewMessage(),e.fetchData()}).finally(function(){t.dismiss()})}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.messages.errordeletemessage",!0)})},n.prototype.loadPrevious=function(n){var l=this;return this.waitForFetch().finally(function(){l.pagesLoaded++,l.fetchData().catch(function(n){l.pagesLoaded--,l.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){n.complete()})})},n.prototype.resizeContent=function(){var n=this,l=this.content.getContentDimensions().scrollTop;this.content.resize(),setTimeout(function(){!n.viewDestroyed&&n.content&&n.domUtils.getContentHeight(n.content)!=n.oldContentHeight&&(l||(l=n.content.getContentDimensions().scrollTop),l+=n.oldContentHeight-n.domUtils.getContentHeight(n.content),n.oldContentHeight=n.domUtils.getContentHeight(n.content),n.domUtils.scrollTo(n.content,0,l,0))})},n.prototype.scrollToBottom=function(){var n=this;this.scrollBottom&&(setTimeout(function(){n.viewDestroyed||n.domUtils.scrollToBottom(n.content,0)}),this.scrollBottom=!1)},n.prototype.sendMessage=function(n){var l,e=this;this.hideUnreadLabel(),this.showDelete=!1,this.scrollBottom=!0,l={pending:!0,sending:!0,useridfrom:this.currentUserId,smallmessage:n,text:n,timecreated:(new Date).getTime()},this.addMessage(l,!1),this.messagesBeingSent++,this.waitForFetch().finally(function(){e.messagesProvider.sendMessage(e.userId,n).then(function(n){e.messagesBeingSent--,(n.sent?e.fetchData():Promise.reject(null)).catch(function(){l.sending=!1,n.sent?l.pending=!1:n.message&&(l.timecreated=n.message.timecreated),e.notifyNewMessage()})}).catch(function(n){e.messagesBeingSent--,e.appProvider.closeKeyboard(),e.domUtils.showErrorModalDefault(n,"addon.messages.messagenotsent",!0),e.removeMessage(l.hash)})})},n.prototype.showDate=function(n,l){return!l||!n.pending&&!I(n.timecreated).isSame(l.timecreated,"day")},n.prototype.toggleDelete=function(){this.showDelete=!this.showDelete},n.prototype.ngOnDestroy=function(){this.unsetPolling(),this.syncObserver&&this.syncObserver.off(),this.keyboardObserver&&this.keyboardObserver.off(),this.viewDestroyed=!0},n}(),C=e(33),D=e(29),k=e(110),x=function(){return function(){}}(),U=e(1273),K=e(1274),L=e(1275),S=e(1276),E=e(1277),F=e(1278),R=e(1279),T=e(1280),A=e(1281),B=e(1284),O=e(1285),X=e(1286),z=e(676),$=e(7),N=e(61),H=e(30),W=e(18),V=e(42),j=e(215),G=e(46),q=e(41),Y=e(9),J=e(34),Q=e(1353),Z=e(21),nn=e(20),ln=e(28),en=e(31),tn=e(40),sn=e(12),an=e(15),on=e(25),un=e(17),rn=e(23),cn=e(22),dn=e(24),gn=e(35),fn=e(38),mn=e(164),hn=e(134),_n=e(325),pn=e(417),yn=e(36),vn=e(1282),bn=e(191),Mn=e(27),wn=e(632),In=e(1283),Pn=e(324),Cn=e(236),Dn=e(418),kn=e(88),xn=e(79),Un=e(238),Kn=e(162),Ln=e(178),Sn=e(26),En=e(100),Fn=e(57),Rn=e(51),Tn=e(219),An=e(429),Bn=e(243),On=e(75),Xn=e(37),zn=e(652),$n=e(1884),Nn=e(1887),Hn=e(1299),Wn=e(60),Vn=d._14({encapsulation:2,styles:[],data:{animation:[{type:7,name:"coreSlideInOut",definitions:[{type:1,expr:"void => fromLeft",animation:[{type:6,styles:{transform:"translateX(0)",opacity:1},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"translateX(-100%)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(5%)",offset:.7},offset:null},{type:6,styles:{opacity:1,transform:"translateX(0)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"fromLeft => void",animation:[{type:6,styles:{transform:"translateX(-100%)",opacity:0},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:1,transform:"translateX(0)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(5%)",offset:.3},offset:null},{type:6,styles:{opacity:0,transform:"translateX(-100%)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"void => fromRight",animation:[{type:6,styles:{transform:"translateX(0)",opacity:1},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"translateX(100%)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(-5%)",offset:.7},offset:null},{type:6,styles:{opacity:1,transform:"translateX(0)",offset:1},offset:null}]},timings:300}],options:null},{type:1,expr:"fromRight => void",animation:[{type:6,styles:{transform:"translateX(-100%)",opacity:0},offset:null},{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:1,transform:"translateX(0)",offset:0},offset:null},{type:6,styles:{opacity:1,transform:"translateX(-5%)",offset:.3},offset:null},{type:6,styles:{opacity:0,transform:"translateX(100%)",offset:1},offset:null}]},timings:300}],options:null}],options:{}}]}}),jn=d._12("page-addon-messages-discussion",P,function(n){return d._42(0,[(n()(),d._16(0,0,null,null,1,"page-addon-messages-discussion",[],null,null,null,c,Vn)),d._15(1,180224,null,0,P,[f.a,m.a,Wn.a,p.a,cn.a,_.a,y.a,h.a,b.a,v.a,M.a,W.a],null,null)],null,null)},{},{},[]),Gn=e(19),qn=e(320),Yn=e(321),Jn=e(323),Qn=e(322),Zn=e(416),nl=e(631),ll=e(237);e.d(l,"AddonMessagesDiscussionPageModuleNgFactory",function(){return el});var el=d._13(x,[],function(n){return d._25([d._26(512,d.n,d._6,[[8,[U.a,K.a,L.a,S.a,E.a,F.a,R.a,T.a,A.a,B.a,O.a,X.a,jn]],[3,d.n],d.B]),d._26(4608,Y.m,Y.l,[d.x,[2,Y.v]]),d._26(4608,Gn.x,Gn.x,[]),d._26(4608,Gn.d,Gn.d,[]),d._26(4608,qn.b,qn.a,[]),d._26(4608,Yn.a,Yn.b,[]),d._26(4608,Jn.b,Jn.a,[]),d._26(4608,Qn.b,Qn.a,[]),d._26(4608,W.a,W.a,[Zn.a,qn.b,Yn.a,Jn.b,Qn.b,W.b,W.c]),d._26(512,Y.b,Y.b,[]),d._26(512,Gn.v,Gn.v,[]),d._26(512,Gn.i,Gn.i,[]),d._26(512,Gn.s,Gn.s,[]),d._26(512,nl.a,nl.a,[]),d._26(512,g.a,g.a,[]),d._26(512,D.a,D.a,[]),d._26(512,k.a,k.a,[]),d._26(512,C.a,C.a,[]),d._26(512,nl.b,nl.b,[]),d._26(512,x,x,[]),d._26(256,W.c,void 0,[]),d._26(256,W.b,void 0,[]),d._26(256,ll.a,P,[])])})},1884:function(n,l,e){"use strict";function t(n){return s._42(2,[(n()(),s._16(0,0,null,null,1,"div",[["class","toolbar-background"]],null,null,null,null,null)),s._15(1,278528,null,0,a.i,[s.v,s.w,s.p,s.L],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),s._28(null,0),s._28(null,1),s._28(null,2),(n()(),s._16(5,0,null,null,2,"div",[["class","toolbar-content"]],null,null,null,null,null)),s._15(6,278528,null,0,a.i,[s.v,s.w,s.p,s.L],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),s._28(null,3)],function(n,l){var e=l.component;n(l,1,0,"toolbar-background","toolbar-background-"+e._mode);n(l,6,0,"toolbar-content","toolbar-content-"+e._mode)},null)}e.d(l,"a",function(){return o}),l.b=t;var s=e(1),a=e(9),o=(e(7),s._14({encapsulation:2,styles:[],data:{}}))},1887:function(n,l,e){"use strict";function t(n){return s._42(0,[(n()(),s._16(0,0,null,null,28,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],function(n,l,e){var t=!0;if("submit"===l){t=!1!==s._29(n,2).onSubmit(e)&&t}if("reset"===l){t=!1!==s._29(n,2).onReset()&&t}return t},null,null)),s._15(1,16384,null,0,a.w,[],null,null),s._15(2,4210688,null,0,a.p,[[8,null],[8,null]],null,null),s._35(2048,null,a.b,null,[a.p]),s._15(4,16384,null,0,a.o,[a.b],null,null),(n()(),s._40(-1,null,["\n    "])),(n()(),s._16(6,0,null,null,7,"textarea",[["class","core-send-message-input"],["core-auto-rows",""],["name","message"],["rows","1"]],[[8,"placeholder",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"onResize"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],function(n,l,e){var t=!0,a=n.component;if("input"===l){t=!1!==s._29(n,7)._handleInput(e.target.value)&&t}if("blur"===l){t=!1!==s._29(n,7).onTouched()&&t}if("compositionstart"===l){t=!1!==s._29(n,7)._compositionStart()&&t}if("compositionend"===l){t=!1!==s._29(n,7)._compositionEnd(e.target.value)&&t}if("input"===l){t=!1!==s._29(n,13).onInput()&&t}if("change"===l){t=!1!==s._29(n,13).onChange()&&t}if("ngModelChange"===l){t=!1!==(a.message=e)&&t}if("onResize"===l){t=!1!==a.textareaResized()&&t}return t},null,null)),s._15(7,16384,null,0,a.c,[s.L,s.p,[2,a.a]],null,null),s._35(1024,null,a.l,function(n){return[n]},[a.c]),s._15(9,671744,null,0,a.q,[[2,a.b],[8,null],[8,null],[2,a.l]],{name:[0,"name"],model:[1,"model"]},{update:"ngModelChange"}),s._35(2048,null,a.m,null,[a.q]),s._15(11,16384,null,0,a.n,[a.m],null,null),s._15(12,81920,null,0,o.a,[s.p,i.a,u.a,[2,r.a]],{coreAutoFocus:[0,"coreAutoFocus"]},null),s._15(13,4210688,null,0,c.a,[s.p],null,{onResize:"onResize"}),(n()(),s._40(-1,null,["\n    "])),(n()(),s._16(15,0,null,null,12,"ion-buttons",[["end",""]],null,null,null,null,null)),s._15(16,16384,null,1,d.a,[g.a,s.p,s.K,[2,f.a],[2,m.a]],null,null),s._37(603979776,1,{_buttons:1}),(n()(),s._40(-1,null,["\n        "])),(n()(),s._16(19,0,null,null,7,"button",[["clear","true"],["icon-only",""],["ion-button",""],["type","submit"]],[[8,"disabled",0],[1,"aria-label",0]],[[null,"onClick"]],function(n,l,e){var t=!0;if("onClick"===l){t=!1!==n.component.submitForm(e)&&t}return t},h.b,h.a)),s._15(20,1097728,[[1,4]],0,_.a,[[8,""],g.a,s.p,s.K],{clear:[0,"clear"]},null),s._15(21,81920,null,0,p.a,[s.p],null,{onClick:"onClick"}),s._32(131072,y.a,[v.a,s.i]),(n()(),s._40(-1,0,["\n            "])),(n()(),s._16(24,0,null,0,1,"ion-icon",[["color","dark"],["name","send"],["role","img"]],[[2,"hide",null]],null,null,null,null)),s._15(25,147456,null,0,b.a,[g.a,s.p,s.K],{color:[0,"color"],name:[1,"name"]},null),(n()(),s._40(-1,0,["\n        "])),(n()(),s._40(-1,null,["\n    "])),(n()(),s._40(-1,null,["\n"])),(n()(),s._40(-1,null,["\n"]))],function(n,l){var e=l.component;n(l,9,0,"message",e.message);n(l,12,0,e.showKeyboard);n(l,20,0,"true"),n(l,21,0);n(l,25,0,"dark","send")},function(n,l){var e=l.component;n(l,0,0,s._29(l,4).ngClassUntouched,s._29(l,4).ngClassTouched,s._29(l,4).ngClassPristine,s._29(l,4).ngClassDirty,s._29(l,4).ngClassValid,s._29(l,4).ngClassInvalid,s._29(l,4).ngClassPending);n(l,6,0,e.placeholder,s._29(l,11).ngClassUntouched,s._29(l,11).ngClassTouched,s._29(l,11).ngClassPristine,s._29(l,11).ngClassDirty,s._29(l,11).ngClassValid,s._29(l,11).ngClassInvalid,s._29(l,11).ngClassPending);n(l,19,0,!e.message,s._41(l,19,1,s._29(l,22).transform("core.send")));n(l,24,0,s._29(l,25)._hidden)})}e.d(l,"a",function(){return M}),l.b=t;var s=e(1),a=e(19),o=e(327),i=e(4),u=e(3),r=e(22),c=e(335),d=e(418),g=e(7),f=e(236),m=e(191),h=e(46),_=e(41),p=e(338),y=e(30),v=e(18),b=e(42),M=(e(12),s._14({encapsulation:2,styles:[],data:{}}))}});